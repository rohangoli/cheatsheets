<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetBackup MSDP-C Architecture & Data Flow</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap');

  :root {
    --bg: #0a0e1a;
    --bg2: #0f1628;
    --panel: #131b2e;
    --border: #1e2d4a;
    --accent: #00d4ff;
    --accent2: #ff6b35;
    --accent3: #7c3aed;
    --green: #22c55e;
    --yellow: #fbbf24;
    --red: #ef4444;
    --text: #e2e8f0;
    --muted: #64748b;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    padding: 2rem;
  }

  h1 {
    font-size: 1.6rem;
    font-weight: 800;
    color: var(--accent);
    letter-spacing: -0.02em;
    margin-bottom: 0.25rem;
  }
  .subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    color: var(--muted);
    margin-bottom: 2rem;
    letter-spacing: 0.1em;
  }

  /* Tabs */
  .tabs { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
  .tab {
    padding: 0.4rem 1rem;
    border: 1px solid var(--border);
    border-radius: 4px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    cursor: pointer;
    color: var(--muted);
    background: var(--panel);
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }
  .tab:hover { border-color: var(--accent); color: var(--accent); }
  .tab.active { border-color: var(--accent); color: var(--accent); background: rgba(0,212,255,0.08); }

  /* Panels */
  .section { display: none; }
  .section.active { display: block; }

  /* ─── Diagram Canvas ─── */
  .diagram {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 2rem;
    overflow-x: auto;
  }

  .arch-grid {
    display: grid;
    grid-template-columns: 180px 160px 200px 160px 200px;
    grid-template-rows: auto auto auto;
    gap: 0;
    align-items: center;
    min-width: 960px;
    position: relative;
  }

  .node {
    border-radius: 6px;
    padding: 0.75rem 1rem;
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    position: relative;
    z-index: 2;
  }
  .node-label { font-size: 0.65rem; font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 0.3rem; }
  .node-name { font-size: 0.78rem; font-weight: 600; }
  .node-detail { font-size: 0.6rem; color: var(--muted); margin-top: 0.2rem; }

  .node-source { background: rgba(124,58,237,0.15); border: 1.5px solid var(--accent3); }
  .node-source .node-label { color: var(--accent3); }

  .node-master { background: rgba(251,191,36,0.1); border: 1.5px solid var(--yellow); }
  .node-master .node-label { color: var(--yellow); }

  .node-media { background: rgba(0,212,255,0.08); border: 1.5px solid var(--accent); }
  .node-media .node-label { color: var(--accent); }

  .node-cloud { background: rgba(34,197,94,0.1); border: 1.5px solid var(--green); }
  .node-cloud .node-label { color: var(--green); }

  .node-msdp { background: rgba(255,107,53,0.1); border: 1.5px solid var(--accent2); }
  .node-msdp .node-label { color: var(--accent2); }

  /* Arrows via SVG */
  .flow-svg {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 1;
  }

  /* Arrow labels */
  .arrow-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.58rem;
    fill: var(--muted);
  }
  .arrow-label-highlight { fill: var(--accent); }

  /* Fix: prevent page CSS (line-height etc.) from shifting SVG text positions */
  svg text {
    line-height: normal;
    dominant-baseline: alphabetic;
    alignment-baseline: baseline;
  }

  /* ─── Flow Steps ─── */
  .flow-steps { display: flex; flex-direction: column; gap: 0.6rem; margin-top: 1.5rem; }
  .step {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 0.75rem 1rem;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    border-left: 3px solid transparent;
    transition: all 0.2s;
  }
  .step:hover { border-color: var(--border); border-left-color: var(--accent); background: rgba(0,212,255,0.04); }
  .step-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 0.15rem 0.45rem;
    border-radius: 3px;
    min-width: 28px;
    text-align: center;
    flex-shrink: 0;
  }
  .step-num-backup { background: rgba(0,212,255,0.15); color: var(--accent); }
  .step-num-restore { background: rgba(255,107,53,0.15); color: var(--accent2); }
  .step-content { flex: 1; }
  .step-title { font-size: 0.8rem; font-weight: 700; margin-bottom: 0.2rem; }
  .step-desc { font-size: 0.72rem; color: #94a3b8; line-height: 1.5; }
  .hop-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.58rem;
    padding: 0.1rem 0.4rem;
    border-radius: 3px;
    margin-left: 0.5rem;
    vertical-align: middle;
  }
  .hop-1 { background: rgba(34,197,94,0.15); color: var(--green); border: 1px solid rgba(34,197,94,0.3); }
  .hop-2 { background: rgba(255,107,53,0.15); color: var(--accent2); border: 1px solid rgba(255,107,53,0.3); }

  /* Config table */
  .config-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
  @media(max-width:700px){ .config-grid { grid-template-columns: 1fr; } }
  .config-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem 1.25rem;
  }
  .config-card h3 { font-size: 0.75rem; font-weight: 700; color: var(--accent); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 0.75rem; }
  .config-item { display: flex; justify-content: space-between; gap: 0.5rem; margin-bottom: 0.5rem; align-items: flex-start; }
  .config-key { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--muted); flex-shrink: 0; }
  .config-val { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--text); text-align: right; }
  .tag { display: inline-block; font-size: 0.58rem; padding: 0.1rem 0.4rem; border-radius: 3px; }
  .tag-ok { background: rgba(34,197,94,0.15); color: var(--green); }
  .tag-warn { background: rgba(251,191,36,0.15); color: var(--yellow); }
  .tag-bad { background: rgba(239,68,68,0.15); color: var(--red); }

  /* Bottleneck table */
  .bttl-table { width: 100%; border-collapse: collapse; font-family: 'JetBrains Mono', monospace; font-size: 0.68rem; }
  .bttl-table th { background: var(--panel); padding: 0.6rem 0.8rem; text-align: left; font-size: 0.65rem; letter-spacing: 0.08em; color: var(--muted); border-bottom: 1px solid var(--border); }
  .bttl-table td { padding: 0.6rem 0.8rem; border-bottom: 1px solid rgba(30,45,74,0.5); vertical-align: top; }
  .bttl-table tr:hover td { background: rgba(0,212,255,0.03); }
  .sev { font-weight: 700; text-transform: uppercase; font-size: 0.6rem; }
  .sev-high { color: var(--red); }
  .sev-med { color: var(--yellow); }
  .sev-low { color: var(--green); }

  /* N-media grid */
  .n-media-diagram {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  .media-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .media-card-title {
    font-size: 0.7rem; font-weight: 700; color: var(--accent);
    font-family: 'JetBrains Mono', monospace; letter-spacing: 0.08em;
    text-transform: uppercase; margin-bottom: 0.25rem;
  }
  .sub-node {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 0.4rem 0.6rem;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.62rem;
  }
  .sub-node-label { color: var(--muted); font-size: 0.55rem; text-transform: uppercase; letter-spacing: 0.08em; }
  .sub-node-val { color: var(--text); margin-top: 0.1rem; }
  .arrow-down { text-align: center; color: var(--muted); font-size: 1rem; }
  .master-node {
    background: rgba(251,191,36,0.08);
    border: 1px solid var(--yellow);
    border-radius: 6px;
    padding: 0.75rem 1rem;
    text-align: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--yellow);
    font-weight: 700;
    letter-spacing: 0.06em;
    margin-bottom: 1rem;
  }
  .connect-line {
    border-top: 1px dashed var(--border);
    margin: 0.5rem 0;
  }

  .note-box {
    background: rgba(251,191,36,0.05);
    border: 1px solid rgba(251,191,36,0.2);
    border-left: 3px solid var(--yellow);
    border-radius: 4px;
    padding: 0.75rem 1rem;
    font-size: 0.72rem;
    color: #cbd5e1;
    line-height: 1.6;
    margin-top: 1rem;
  }
  .note-box strong { color: var(--yellow); }

  .info-box {
    background: rgba(0,212,255,0.04);
    border: 1px solid rgba(0,212,255,0.15);
    border-left: 3px solid var(--accent);
    border-radius: 4px;
    padding: 0.75rem 1rem;
    font-size: 0.72rem;
    color: #cbd5e1;
    line-height: 1.6;
    margin-top: 0.75rem;
  }
  .info-box strong { color: var(--accent); }

  /* Inline diagram for N-media */
  .central-line {
    display: flex; justify-content: center;
    position: relative; margin: 0.5rem 0;
  }
  .central-line::before {
    content: '';
    position: absolute;
    top: 50%; left: 10%; right: 10%;
    height: 1px;
    border-top: 1px dashed var(--border);
  }
</style>
</head>
<body>

<h1>NetBackup MSDP Cloud (MSDP-C) Architecture</h1>
<p class="subtitle">// PUREDISK STORAGE SERVER + CLOUD S3 VOLUME · DATA FLOW REFERENCE</p>

<div class="tabs">
  <div class="tab active" onclick="show('backup-flow')">Backup Data Flow</div>
  <div class="tab" onclick="show('restore-flow')">Restore Data Flow</div>
  <div class="tab" onclick="show('n-media')">N Media Servers Config</div>
  <div class="tab" onclick="show('bottlenecks')">Performance Bottlenecks</div>
</div>

<!-- ════════ TAB 1: BACKUP FLOW ════════ -->
<div class="section active" id="backup-flow">
  <div class="diagram" style="padding:1.5rem 1rem;">
    <div style="width:100%; overflow-x:auto;">
      <svg viewBox="0 0 1040 550" xmlns="http://www.w3.org/2000/svg" style="display:block; min-width:900px; width:100%;">
        <defs>
          <marker id="ah"  viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#00d4ff"/></marker>
          <marker id="ah2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#22c55e"/></marker>
          <marker id="ah4" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#fbbf24"/></marker>
        </defs>

        <!-- ══ ROW 1: Source1 → MediaSvr1 → S3-1  (vertical center y=115) ══ -->

        <!-- Source Client 1 -->
        <rect x="10"  y="72"  width="160" height="70" rx="5" fill="rgba(124,58,237,0.15)" stroke="#7c3aed" stroke-width="1.5"/>
        <text x="90" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#7c3aed" font-weight="700" letter-spacing="1">SOURCE</text>
        <text x="90" y="110" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#e2e8f0">Client / App Server</text>
        <text x="90" y="124" text-anchor="middle" font-family="JetBrains Mono" font-size="8"  fill="#64748b">nbclient / pdplugin</text>

        <!-- HOP-1 arrow label badge (Source1 → Media1) — in corridor x=170..400, y=72..142 -->
        <rect x="172" y="79"  width="220" height="34" rx="3" fill="rgba(0,212,255,0.07)" stroke="rgba(0,212,255,0.25)" stroke-width="1"/>
        <text x="282" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#00d4ff" font-weight="700">① Deduped data  ·  HOP 1</text>
        <text x="282" y="107" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">source-side dedup via pdplugin</text>
        <!-- arrow line -->
        <line x1="170" y1="114" x2="397" y2="114" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#ah)"/>

        <!-- Media Server 1 -->
        <rect x="400" y="14"  width="230" height="200" rx="5" fill="rgba(0,212,255,0.04)" stroke="#00d4ff" stroke-width="1.5"/>
        <text x="515" y="36"  text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#00d4ff" font-weight="700" letter-spacing="1">MEDIA SERVER 1</text>
        <text x="515" y="52"  text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#e2e8f0">nbm1  /  pdde daemon</text>
        <!-- MSDP sub-box -->
        <rect x="413" y="62"  width="204" height="120" rx="4" fill="rgba(255,107,53,0.1)" stroke="#ff6b35" stroke-width="1"/>
        <text x="515" y="81"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">LOCAL MSDP POOL</text>
        <line x1="413" y1="88" x2="617" y2="88" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.4"/>
        <text x="515" y="103" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">PureDisk Volume  ·  Dedup DB</text>
        <text x="515" y="117" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">Cloud Cache  ·  Upload / Download</text>
        <text x="515" y="131" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">Container Assembly (64 MB)</text>
        <text x="515" y="147" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">UploadCacheDB: 12 GB (default)</text>
        <text x="515" y="161" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">DownloadDataCacheGB: 1 TB (default)</text>
        <!-- outer footer -->
        <text x="515" y="200" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">pdde pushes containers via HTTPS PUT</text>

        <!-- HOP-2 arrow label badge (Media1 → S3-1) — corridor x=632..760 -->
        <rect x="634" y="79"  width="122" height="34" rx="3" fill="rgba(34,197,94,0.07)" stroke="rgba(34,197,94,0.25)" stroke-width="1"/>
        <text x="695" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700">② HOP 2  ·  S3 PUT</text>
        <text x="695" y="107" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">64 MB containers</text>
        <!-- arrow line -->
        <line x1="632" y1="114" x2="757" y2="114" stroke="#22c55e" stroke-width="1.5" marker-end="url(#ah2)"/>

        <!-- S3 Bucket 1 -->
        <rect x="760" y="72"  width="200" height="70" rx="5" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="860" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700" letter-spacing="0.5">CLOUD OBJECT STORE</text>
        <text x="860" y="109" text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">S3 Bucket  ·  LSU-1</text>
        <text x="860" y="124" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">data + header files</text>

        <!-- ══ ROW 2: Source2 → MediaSvr2 → S3-2  (vertical center y=315) ══ -->

        <!-- Source Client 2 -->
        <rect x="10"  y="272" width="160" height="70" rx="5" fill="rgba(124,58,237,0.15)" stroke="#7c3aed" stroke-width="1.5"/>
        <text x="90" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#7c3aed" font-weight="700" letter-spacing="1">SOURCE</text>
        <text x="90" y="310" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#e2e8f0">Client / App Server</text>
        <text x="90" y="324" text-anchor="middle" font-family="JetBrains Mono" font-size="8"  fill="#64748b">nbclient / pdplugin</text>

        <!-- HOP-1 arrow label badge (Source2 → Media2) -->
        <rect x="172" y="279" width="220" height="34" rx="3" fill="rgba(0,212,255,0.07)" stroke="rgba(0,212,255,0.25)" stroke-width="1"/>
        <text x="282" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#00d4ff" font-weight="700">① Deduped data  ·  HOP 1</text>
        <text x="282" y="307" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">source-side dedup via pdplugin</text>
        <!-- arrow line -->
        <line x1="170" y1="314" x2="397" y2="314" stroke="#00d4ff" stroke-width="1.5" marker-end="url(#ah)"/>

        <!-- Media Server 2 -->
        <rect x="400" y="214" width="230" height="200" rx="5" fill="rgba(0,212,255,0.04)" stroke="#00d4ff" stroke-width="1.5"/>
        <text x="515" y="236" text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#00d4ff" font-weight="700" letter-spacing="1">MEDIA SERVER 2</text>
        <text x="515" y="252" text-anchor="middle" font-family="JetBrains Mono" font-size="10" fill="#e2e8f0">nbm2  /  pdde daemon</text>
        <rect x="413" y="262" width="204" height="120" rx="4" fill="rgba(255,107,53,0.1)" stroke="#ff6b35" stroke-width="1"/>
        <text x="515" y="281" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">LOCAL MSDP POOL</text>
        <line x1="413" y1="288" x2="617" y2="288" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.4"/>
        <text x="515" y="303" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">PureDisk Volume  ·  Dedup DB</text>
        <text x="515" y="317" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">Cloud Cache  ·  Upload / Download</text>
        <text x="515" y="331" text-anchor="middle" font-family="JetBrains Mono" font-size="8"   fill="#94a3b8">Container Assembly (64 MB)</text>
        <text x="515" y="347" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">UploadCacheDB: 12 GB (default)</text>
        <text x="515" y="361" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">DownloadDataCacheGB: 1 TB (default)</text>
        <text x="515" y="400" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">pdde pushes containers via HTTPS PUT</text>

        <!-- HOP-2 arrow label badge (Media2 → S3-2) -->
        <rect x="634" y="279" width="122" height="34" rx="3" fill="rgba(34,197,94,0.07)" stroke="rgba(34,197,94,0.25)" stroke-width="1"/>
        <text x="695" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700">② HOP 2  ·  S3 PUT</text>
        <text x="695" y="307" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">64 MB containers</text>
        <!-- arrow line -->
        <line x1="632" y1="314" x2="757" y2="314" stroke="#22c55e" stroke-width="1.5" marker-end="url(#ah2)"/>

        <!-- S3 Bucket 2 -->
        <rect x="760" y="272" width="200" height="70" rx="5" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="860" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700" letter-spacing="0.5">CLOUD OBJECT STORE</text>
        <text x="860" y="309" text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">S3 Bucket  ·  LSU-2</text>
        <text x="860" y="324" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">data + header files</text>

        <!-- ══ NBU MASTER  (below left, between the two rows) ══ -->
        <rect x="10" y="388" width="190" height="78" rx="5" fill="rgba(251,191,36,0.08)" stroke="#fbbf24" stroke-width="1.5"/>
        <text x="105" y="409" text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#fbbf24" font-weight="700" letter-spacing="1">NBU MASTER</text>
        <text x="105" y="424" text-anchor="middle" font-family="JetBrains Mono" font-size="9"  fill="#e2e8f0">Primary Server</text>
        <text x="105" y="439" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">Policy / Job Orchestration</text>
        <text x="105" y="453" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">Catalog · EMM</text>

        <!-- Master → MediaSvr1 control (dashed, going right then up via elbow) -->
        <path d="M 200,415 L 350,415 L 350,114 L 398,114" fill="none" stroke="#fbbf24" stroke-width="1" stroke-dasharray="5,3" marker-end="url(#ah4)"/>
        <!-- control path label at the corner -->
        <rect x="210" y="406" width="75" height="16" rx="2" fill="rgba(15,22,40,0.9)"/>
        <text x="247" y="418" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#fbbf24">job control</text>

        <!-- Master → MediaSvr2 control (dashed) -->
        <path d="M 200,427 L 370,427 L 370,314 L 398,314" fill="none" stroke="#fbbf24" stroke-width="1" stroke-dasharray="5,3" marker-end="url(#ah4)"/>

        <!-- ══ LEGEND ══ -->
        <rect x="10" y="472" width="960" height="48" rx="4" fill="rgba(15,22,40,0.85)" stroke="#1e2d4a" stroke-width="1"/>
        <text x="22" y="489" font-family="JetBrains Mono" font-size="7.5" fill="#64748b" letter-spacing="1" font-weight="700">LEGEND</text>
        <!-- cyan -->
        <line x1="90" y1="485" x2="118" y2="485" stroke="#00d4ff" stroke-width="1.5"/>
        <polygon points="118,481 126,485 118,489" fill="#00d4ff"/>
        <text x="130" y="489" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Data path (deduplicated) — HOP 1</text>
        <!-- green -->
        <line x1="340" y1="485" x2="368" y2="485" stroke="#22c55e" stroke-width="1.5"/>
        <polygon points="368,481 376,485 368,489" fill="#22c55e"/>
        <text x="380" y="489" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Cloud upload 64 MB containers — HOP 2</text>
        <!-- yellow dashed -->
        <line x1="580" y1="485" x2="608" y2="485" stroke="#fbbf24" stroke-width="1" stroke-dasharray="4,2"/>
        <polygon points="608,481 616,485 608,489" fill="#fbbf24"/>
        <text x="620" y="489" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Job control / orchestration (no data)</text>
        <!-- row 2 of legend -->
        <rect x="22" y="494" width="8" height="8" rx="1" fill="rgba(255,107,53,0.4)" stroke="#ff6b35" stroke-width="0.8"/>
        <text x="34" y="502" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Local MSDP pool = upload cache + fingerprint DB + container assembly staging</text>
      </svg>
    </div>
  </div>

  <div class="flow-steps">
    <div class="step">
      <div class="step-num step-num-backup">①</div>
      <div class="step-content">
        <div class="step-title">HOP 1 — Source Client → NBU Media Server (Local MSDP)<span class="hop-badge hop-1">HOP 1</span></div>
        <div class="step-desc">
          The NetBackup client agent (or source-side deduplication plug-in <code>pdplugin</code>) segments and fingerprints backup data on the source. Only <strong>unique data segments</strong> that don't exist in the MSDP fingerprint database are transferred. The media server receives this deduplicated stream and writes it into its local MSDP PureDisk volume. The MSDP engine also assembles <strong>64 MB container files</strong> in memory (or in the local disk upload cache if RAM is insufficient: rule of thumb = <em>concurrent streams × 128 MB</em> must fit in RAM, else disk cache is used).
        </div>
      </div>
    </div>
    <div class="step">
      <div class="step-num step-num-backup">②</div>
      <div class="step-content">
        <div class="step-title">HOP 2 — Media Server MSDP Cache → Cloud S3 Bucket (Object Store)<span class="hop-badge hop-2">HOP 2</span></div>
        <div class="step-desc">
          Once containers are assembled, the MSDP cloud engine (<code>pdde</code>) pushes the 64 MB container files (data + header) from the local disk/memory cache to the configured <strong>Cloud Logical Storage Unit (LSU)</strong> — directly to the S3 bucket via HTTPS PUT operations. This is a direct media-server-to-S3 transfer. The master server <strong>does not</strong> sit in the data path; it only provides job orchestration. So: <strong>YES — it is always a 2-hop transfer for MSDP-C</strong>.
        </div>
      </div>
    </div>
    <div class="step">
      <div class="step-num step-num-backup">③</div>
      <div class="step-content">
        <div class="step-title">Metadata & Catalog Update → NBU Master Server</div>
        <div class="step-desc">
          After write completion, the media server reports image metadata (fingerprints, extents, image catalog entries) back to the NBU Master. The Master updates the NetBackup catalog. This is a separate, low-bandwidth control plane path — not part of the data flow.
        </div>
      </div>
    </div>
  </div>

  <div class="info-box">
    <strong>Key fact on the 2-hop design:</strong> The local MSDP pool on each media server serves as a <em>staging + cache layer</em>. For the cloud LSU, a default <strong>12 GB upload cache</strong> (UploadCacheDB) and up to <strong>1 TB download cache</strong> (DownloadDataCacheGB) are reserved from the local MSDP pool disk. Each cloud LSU you create reserves ~1 TB of local MSDP pool space. This means your local MSDP pool must be sized accordingly for the number of cloud LSUs hosted.
  </div>
</div>

<!-- ════════ TAB 2: RESTORE FLOW ════════ -->
<div class="section" id="restore-flow">
  <div class="diagram" style="padding:1.5rem 1rem;">
    <div style="width:100%; overflow-x:auto;">
      <svg viewBox="0 0 1040 600" xmlns="http://www.w3.org/2000/svg" style="display:block; min-width:900px; width:100%;">
        <defs>
          <marker id="ra"  viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#ff6b35"/></marker>
          <marker id="ra2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#00d4ff"/></marker>
          <marker id="ra3" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto"><path d="M0,1 L9,5 L0,9 Z" fill="#fbbf24"/></marker>
        </defs>

        <!-- ══════════════════════════════════════════
             ROW 1: S3-1 → Media Server 1 → Client 1
             center-line y = 127
        ══════════════════════════════════════════ -->

        <!-- S3 Bucket 1 -->
        <rect x="10" y="72" width="185" height="108" rx="5" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="102" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700" letter-spacing="0.5">CLOUD S3 BUCKET</text>
        <text x="102" y="109" text-anchor="middle" font-family="JetBrains Mono" font-size="9.5" fill="#e2e8f0">S3 Bucket  ·  LSU-1</text>
        <text x="102" y="124" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">64 MB containers</text>
        <text x="102" y="138" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">data + header files</text>
        <text x="102" y="152" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">HTTPS GET · full container</text>
        <text x="102" y="166" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">even for 1 segment needed</text>

        <!-- HOP-1 badge (S3-1 → Media1) corridor x=197..400 -->
        <rect x="199" y="103" width="195" height="36" rx="3" fill="rgba(255,107,53,0.07)" stroke="rgba(255,107,53,0.3)" stroke-width="1"/>
        <text x="296" y="118" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">① S3 GET  ·  HOP 1</text>
        <text x="296" y="131" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">full 64 MB container → download cache</text>
        <line x1="197" y1="127" x2="397" y2="127" stroke="#ff6b35" stroke-width="1.8" marker-end="url(#ra)"/>

        <!-- Media Server 1 -->
        <rect x="400" y="14" width="240" height="198" rx="5" fill="rgba(0,212,255,0.04)" stroke="#00d4ff" stroke-width="1.5"/>
        <text x="520" y="35"  text-anchor="middle" font-family="JetBrains Mono" font-size="9"   fill="#00d4ff" font-weight="700" letter-spacing="1">MEDIA SERVER 1</text>
        <text x="520" y="51"  text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">nbm1  /  pdde daemon</text>
        <!-- Download Cache sub-box -->
        <rect x="413" y="60" width="214" height="130" rx="4" fill="rgba(255,107,53,0.08)" stroke="#ff6b35" stroke-width="1"/>
        <text x="520" y="78"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">DOWNLOAD CACHE (LOCAL)</text>
        <line x1="413" y1="86" x2="627" y2="86" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.4"/>
        <text x="520" y="101" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">DownloadDataCacheGB (1 TB default)</text>
        <text x="520" y="115" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">DownloadMetaCacheGB (separate)</text>
        <text x="520" y="129" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Containers cached → avoids re-fetch</text>
        <line x1="413" y1="138" x2="627" y2="138" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.3"/>
        <text x="520" y="153" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">P-cache + S-cache  (NBU 10.1+)</text>
        <text x="520" y="167" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">Fingerprint DB → finds container ID</text>
        <text x="520" y="198" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">client never contacts S3 directly</text>

        <!-- HOP-2 badge (Media1 → Client1) corridor x=642..800 -->
        <rect x="644" y="103" width="190" height="36" rx="3" fill="rgba(0,212,255,0.07)" stroke="rgba(0,212,255,0.25)" stroke-width="1"/>
        <text x="739" y="118" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#00d4ff" font-weight="700">② Re-assembled data  ·  HOP 2</text>
        <text x="739" y="131" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">media svr streams to restore client</text>
        <line x1="642" y1="127" x2="837" y2="127" stroke="#00d4ff" stroke-width="1.8" marker-end="url(#ra2)"/>

        <!-- Restore Target Client 1 -->
        <rect x="840" y="72" width="185" height="108" rx="5" fill="rgba(124,58,237,0.15)" stroke="#7c3aed" stroke-width="1.5"/>
        <text x="932" y="94"  text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#7c3aed" font-weight="700" letter-spacing="0.5">RESTORE TARGET</text>
        <text x="932" y="109" text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">Client / App Server</text>
        <text x="932" y="124" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">receives reassembled image</text>
        <text x="932" y="138" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">from media server stream</text>
        <text x="932" y="152" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">no direct S3 access</text>
        <text x="932" y="166" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">nbclient writes to disk</text>

        <!-- ══════════════════════════════════════════
             ROW 2: S3-2 → Media Server 2 → Client 2
             center-line y = 327
        ══════════════════════════════════════════ -->

        <!-- S3 Bucket 2 -->
        <rect x="10" y="272" width="185" height="108" rx="5" fill="rgba(34,197,94,0.1)" stroke="#22c55e" stroke-width="1.5"/>
        <text x="102" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#22c55e" font-weight="700" letter-spacing="0.5">CLOUD S3 BUCKET</text>
        <text x="102" y="309" text-anchor="middle" font-family="JetBrains Mono" font-size="9.5" fill="#e2e8f0">S3 Bucket  ·  LSU-2</text>
        <text x="102" y="324" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">64 MB containers</text>
        <text x="102" y="338" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">data + header files</text>
        <text x="102" y="352" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">HTTPS GET · full container</text>
        <text x="102" y="366" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">even for 1 segment needed</text>

        <!-- HOP-1 badge (S3-2 → Media2) -->
        <rect x="199" y="303" width="195" height="36" rx="3" fill="rgba(255,107,53,0.07)" stroke="rgba(255,107,53,0.3)" stroke-width="1"/>
        <text x="296" y="318" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">① S3 GET  ·  HOP 1</text>
        <text x="296" y="335" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">full 64 MB container → download cache</text>
        <line x1="197" y1="327" x2="397" y2="327" stroke="#ff6b35" stroke-width="1.8" marker-end="url(#ra)"/>

        <!-- Media Server 2 -->
        <rect x="400" y="214" width="240" height="198" rx="5" fill="rgba(0,212,255,0.04)" stroke="#00d4ff" stroke-width="1.5"/>
        <text x="520" y="235" text-anchor="middle" font-family="JetBrains Mono" font-size="9"   fill="#00d4ff" font-weight="700" letter-spacing="1">MEDIA SERVER 2</text>
        <text x="520" y="251" text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">nbm2  /  pdde daemon</text>
        <rect x="413" y="260" width="214" height="130" rx="4" fill="rgba(255,107,53,0.08)" stroke="#ff6b35" stroke-width="1"/>
        <text x="520" y="278" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#ff6b35" font-weight="700">DOWNLOAD CACHE (LOCAL)</text>
        <line x1="413" y1="286" x2="627" y2="286" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.4"/>
        <text x="520" y="301" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">DownloadDataCacheGB (1 TB default)</text>
        <text x="520" y="315" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">DownloadMetaCacheGB (separate)</text>
        <text x="520" y="329" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Containers cached → avoids re-fetch</text>
        <line x1="413" y1="338" x2="627" y2="338" stroke="#ff6b35" stroke-width="0.5" stroke-dasharray="3,2" opacity="0.3"/>
        <text x="520" y="353" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">P-cache + S-cache  (NBU 10.1+)</text>
        <text x="520" y="367" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">Fingerprint DB → finds container ID</text>
        <text x="520" y="398" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">client never contacts S3 directly</text>

        <!-- HOP-2 badge (Media2 → Client2) -->
        <rect x="644" y="303" width="190" height="36" rx="3" fill="rgba(0,212,255,0.07)" stroke="rgba(0,212,255,0.25)" stroke-width="1"/>
        <text x="739" y="318" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#00d4ff" font-weight="700">② Re-assembled data  ·  HOP 2</text>
        <text x="739" y="331" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">media svr streams to restore client</text>
        <line x1="642" y1="327" x2="837" y2="327" stroke="#00d4ff" stroke-width="1.8" marker-end="url(#ra2)"/>

        <!-- Restore Target Client 2 -->
        <rect x="840" y="272" width="185" height="108" rx="5" fill="rgba(124,58,237,0.15)" stroke="#7c3aed" stroke-width="1.5"/>
        <text x="932" y="294" text-anchor="middle" font-family="JetBrains Mono" font-size="8.5" fill="#7c3aed" font-weight="700" letter-spacing="0.5">RESTORE TARGET</text>
        <text x="932" y="309" text-anchor="middle" font-family="JetBrains Mono" font-size="10"  fill="#e2e8f0">Client / App Server</text>
        <text x="932" y="324" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">receives reassembled image</text>
        <text x="932" y="338" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">from media server stream</text>
        <text x="932" y="352" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">no direct S3 access</text>
        <text x="932" y="366" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">nbclient writes to disk</text>

        <!-- ══ NBU MASTER  (bottom-left, mirroring backup) ══ -->
        <rect x="10" y="428" width="195" height="82" rx="5" fill="rgba(251,191,36,0.08)" stroke="#fbbf24" stroke-width="1.5"/>
        <text x="107" y="449" text-anchor="middle" font-family="JetBrains Mono" font-size="9"   fill="#fbbf24" font-weight="700" letter-spacing="1">NBU MASTER</text>
        <text x="107" y="464" text-anchor="middle" font-family="JetBrains Mono" font-size="9"   fill="#e2e8f0">Primary Server</text>
        <text x="107" y="479" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">Catalog lookup → job dispatch</text>
        <text x="107" y="493" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#64748b">assigns job to correct media server</text>

        <!-- Master → Media1 control (elbow up and right) -->
        <path d="M 207,452 L 360,452 L 360,127 L 398,127" fill="none" stroke="#fbbf24" stroke-width="1" stroke-dasharray="5,3" marker-end="url(#ra3)"/>
        <rect x="215" y="443" width="72" height="14" rx="2" fill="rgba(10,14,26,0.9)"/>
        <text x="251" y="454" text-anchor="middle" font-family="JetBrains Mono" font-size="7.5" fill="#fbbf24">job control</text>

        <!-- Master → Media2 control (elbow) -->
        <path d="M 207,464 L 376,464 L 376,327 L 398,327" fill="none" stroke="#fbbf24" stroke-width="1" stroke-dasharray="5,3" marker-end="url(#ra3)"/>

        <!-- ══ LEGEND ══ -->
        <rect x="10" y="520" width="870" height="46" rx="4" fill="rgba(15,22,40,0.85)" stroke="#1e2d4a" stroke-width="1"/>
        <text x="22" y="537" font-family="JetBrains Mono" font-size="7.5" fill="#64748b" letter-spacing="1" font-weight="700">RESTORE LEGEND</text>
        <line x1="130" y1="533" x2="156" y2="533" stroke="#ff6b35" stroke-width="1.8"/>
        <polygon points="156,529 164,533 156,537" fill="#ff6b35"/>
        <text x="168" y="537" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">HOP 1: S3 → Media Server download cache  (full 64 MB container per GET)</text>
        <line x1="130" y1="550" x2="156" y2="550" stroke="#00d4ff" stroke-width="1.8"/>
        <polygon points="156,546 164,550 156,554" fill="#00d4ff"/>
        <text x="168" y="554" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">HOP 2: Media Server → Restore target  (reassembled segments, client never hits S3)</text>
        <line x1="570" y1="533" x2="596" y2="533" stroke="#fbbf24" stroke-width="1" stroke-dasharray="4,2"/>
        <polygon points="596,529 604,533 596,537" fill="#fbbf24"/>
        <text x="608" y="537" font-family="JetBrains Mono" font-size="7.5" fill="#94a3b8">Job control / orchestration (no data)</text>
      </svg>
    </div>
  </div>

  <div class="flow-steps">
    <div class="step">
      <div class="step-num step-num-restore">①</div>
      <div class="step-content">
        <div class="step-title">NBU Master — Catalog Lookup & Job Dispatch</div>
        <div class="step-desc">
          The master server receives the restore request, looks up the image catalog to find which cloud LSU and S3 bucket contains the data, then dispatches the restore job to the appropriate media server hosting that cloud LSU.
        </div>
      </div>
    </div>
    <div class="step">
      <div class="step-num step-num-restore">②</div>
      <div class="step-content">
        <div class="step-title">HOP 1 — S3 Bucket → Media Server Download Cache<span class="hop-badge hop-1">HOP 1</span></div>
        <div class="step-desc">
          The media server issues S3 GET requests to fetch the required <strong>entire 64 MB container files</strong> — even if only a small segment of that container is needed for the restore. The containers are written to the local <strong>download cache</strong> on the MSDP pool disk. The P-cache/S-cache mechanism (introduced in NBU 10.1) predicts and pre-fetches likely-to-be-needed fingerprints, reducing redundant S3 GET calls when multiple concurrent restore streams reference the same containers.
        </div>
      </div>
    </div>
    <div class="step">
      <div class="step-num step-num-restore">③</div>
      <div class="step-content">
        <div class="step-title">HOP 2 — Media Server → Source/Target Client<span class="hop-badge hop-2">HOP 2</span></div>
        <div class="step-desc">
          The media server re-assembles the required data segments from the downloaded containers in its local MSDP cache and streams the reconstructed data to the restore target client. This is again a <strong>2-hop restore</strong>: Cloud → Media Server → Client. The client never talks directly to S3.
        </div>
      </div>
    </div>
  </div>

  <div class="note-box">
    <strong>Important restore performance note:</strong> Because restores always fetch the full 64 MB container regardless of how much data within it is needed, restore performance is heavily influenced by WAN/internet bandwidth between the media server and the S3 endpoint. The download cache size (default 1 TB per cloud LSU) is critical — if cache is exhausted, containers are evicted and the same container may need to be re-fetched from S3, drastically increasing restore latency.
  </div>
</div>

<!-- ════════ TAB 3: N MEDIA SERVERS ════════ -->
<div class="section" id="n-media">
  <div class="master-node">NBU PRIMARY (MASTER) SERVER — 1× · Policy engine · Catalog · Job scheduling · EMM</div>

  <div style="text-align:center; color: var(--muted); font-family:'JetBrains Mono',monospace; font-size:0.7rem; margin-bottom:0.5rem; letter-spacing:0.08em;">
    ─── CONTROL PLANE (job dispatch, image catalog updates) ───
  </div>

  <div class="n-media-diagram">
    <!-- Media Server 1 -->
    <div class="media-card">
      <div class="media-card-title">Media Server 1</div>
      <div class="sub-node">
        <div class="sub-node-label">PureDisk Storage Server</div>
        <div class="sub-node-val">nbm1 (stype=PureDisk)</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Local MSDP Pool (Disk Pool 1)</div>
        <div class="sub-node-val">PureDisk Vol + Dedup DB</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Cloud LSU (Cloud Volume in Disk Pool)</div>
        <div class="sub-node-val">lsuName: cloud-lsu-1</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node" style="border-color:#22c55e;">
        <div class="sub-node-label" style="color:#22c55e;">S3 Bucket</div>
        <div class="sub-node-val">bucket-nbm1 / sub-path</div>
      </div>
      <div class="sub-node" style="margin-top:0.25rem; background:rgba(0,212,255,0.05);">
        <div class="sub-node-label">Storage Unit</div>
        <div class="sub-node-val">stu-cloud-nbm1 → Disk Pool 1</div>
      </div>
    </div>

    <!-- Media Server 2 -->
    <div class="media-card">
      <div class="media-card-title">Media Server 2</div>
      <div class="sub-node">
        <div class="sub-node-label">PureDisk Storage Server</div>
        <div class="sub-node-val">nbm2 (stype=PureDisk)</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Local MSDP Pool (Disk Pool 2)</div>
        <div class="sub-node-val">PureDisk Vol + Dedup DB</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Cloud LSU (Cloud Volume in Disk Pool)</div>
        <div class="sub-node-val">lsuName: cloud-lsu-2</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node" style="border-color:#22c55e;">
        <div class="sub-node-label" style="color:#22c55e;">S3 Bucket</div>
        <div class="sub-node-val">bucket-nbm2 / sub-path</div>
      </div>
      <div class="sub-node" style="margin-top:0.25rem; background:rgba(0,212,255,0.05);">
        <div class="sub-node-label">Storage Unit</div>
        <div class="sub-node-val">stu-cloud-nbm2 → Disk Pool 2</div>
      </div>
    </div>

    <!-- Media Server N -->
    <div class="media-card" style="border-style:dashed;">
      <div class="media-card-title">Media Server N</div>
      <div class="sub-node">
        <div class="sub-node-label">PureDisk Storage Server</div>
        <div class="sub-node-val">nbmN (stype=PureDisk)</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Local MSDP Pool (Disk Pool N)</div>
        <div class="sub-node-val">PureDisk Vol + Dedup DB</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node">
        <div class="sub-node-label">Cloud LSU</div>
        <div class="sub-node-val">lsuName: cloud-lsu-N</div>
      </div>
      <div class="arrow-down">↓</div>
      <div class="sub-node" style="border-color:#22c55e;">
        <div class="sub-node-label" style="color:#22c55e;">S3 Bucket</div>
        <div class="sub-node-val">bucket-nbmN / sub-path</div>
      </div>
      <div class="sub-node" style="margin-top:0.25rem; background:rgba(0,212,255,0.05);">
        <div class="sub-node-label">Storage Unit</div>
        <div class="sub-node-val">stu-cloud-nbmN → Disk Pool N</div>
      </div>
    </div>
  </div>

  <div class="info-box" style="margin-top:1.25rem;">
    <strong>Yes — N separate Media Servers with N separate MSDP pools + N separate S3 buckets is a fully supported and correct topology.</strong> Each media server is an independent PureDisk storage server. Each has its own local MSDP disk pool (PureDisk volume), its own cloud LSU pointing to its own S3 bucket (or a unique sub-path/prefix within a shared bucket). The NBU Master orchestrates all of them through the single catalog and EMM (Enterprise Media Manager) database.
  </div>

  <div class="config-grid" style="margin-top:1.25rem;">
    <div class="config-card">
      <h3>Per-Media-Server: What to Create</h3>
      <div class="config-item"><span class="config-key">1. Storage Server</span><span class="config-val">stype=PureDisk, host=nbmX</span></div>
      <div class="config-item"><span class="config-key">2. Cloud Instance</span><span class="config-val">csconfig cldinstance -a (once per provider)</span></div>
      <div class="config-item"><span class="config-key">3. Local MSDP Volume</span><span class="config-val">nbdevconfig -setconfig (storagepath)</span></div>
      <div class="config-item"><span class="config-key">4. Cloud LSU</span><span class="config-val">nbdevconfig -setconfig (add-lsu-cloud)</span></div>
      <div class="config-item"><span class="config-key">5. Disk Pool</span><span class="config-val">nbdevconfig -createdp (includes cloud vol)</span></div>
      <div class="config-item"><span class="config-key">6. Storage Unit</span><span class="config-val">bpstuadd -host nbmX -dp DiskPoolX</span></div>
    </div>
    <div class="config-card">
      <h3>S3 Bucket Sharing: Options</h3>
      <div class="config-item"><span class="config-key">Option A</span><span class="config-val tag tag-ok">Separate buckets per media server</span></div>
      <div class="config-item"><span class="config-key">Option B</span><span class="config-val tag tag-ok">Same bucket, unique lsuCloudBucketSubName</span></div>
      <div class="config-item"><span class="config-key">Option C</span><span class="config-val tag tag-warn">Multiple LSUs per single media server (uses ~1TB local cache each)</span></div>
      <div class="config-item"><span class="config-key">Dedup scope</span><span class="config-val">Per storage server — no cross-media-server dedup</span></div>
      <div class="config-item"><span class="config-key">Cloud Cache</span><span class="config-val">~1 TB local MSDP pool reserved per cloud LSU</span></div>
    </div>
  </div>

  <div class="note-box">
    <strong>Important deduplication scope limitation:</strong> Each media server's MSDP pool has its own fingerprint database. Deduplication only occurs within a single MSDP storage server — there is <strong>no cross-media-server deduplication</strong> in standard MSDP-C. If multiple media servers back up the same clients, you'll get duplication across pools. To share a single dedup namespace across multiple media servers, you would use the <strong>MSDP Scaleout</strong> (NetBackup on AKS/EKS) or fan-in topology with an Access Appliance.
  </div>
</div>

<!-- ════════ TAB 4: BOTTLENECKS ════════ -->
<div class="section" id="bottlenecks">
  <div class="diagram" style="padding:1.5rem;">
    <table class="bttl-table">
      <thead>
        <tr>
          <th>Layer</th>
          <th>Bottleneck</th>
          <th>Severity</th>
          <th>Root Cause</th>
          <th>Mitigation</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>HOP 1<br><span style="color:#00d4ff;font-size:0.6rem;">Source → MediaSvr</span></td>
          <td>Network bandwidth saturation between client and media server</td>
          <td><span class="sev sev-high">High</span></td>
          <td>Large backup jobs competing for same NIC on media server</td>
          <td>Dedicate separate NICs; use source-side dedup to reduce transfer size; tune max streams per STU</td>
        </tr>
        <tr>
          <td>HOP 2<br><span style="color:#22c55e;font-size:0.6rem;">MediaSvr → S3</span></td>
          <td>WAN/internet egress bandwidth to cloud provider</td>
          <td><span class="sev sev-high">High</span></td>
          <td>Cloud upload is bounded by available uplink; 64 MB container uploads are bulk and sequential</td>
          <td>AWS Direct Connect / Azure ExpressRoute for dedicated link; enable bandwidth throttling (nbdevconfig); increase concurrent upload threads</td>
        </tr>
        <tr>
          <td>Media Server RAM</td>
          <td>In-memory container assembly overflow to disk cache</td>
          <td><span class="sev sev-high">High</span></td>
          <td>If concurrent streams × 128 MB > UsableMemoryLimit, disk cache is used, adding I/O latency</td>
          <td>Ensure RAM ≥ (concurrent_streams × 128 MB) + fingerprint cache + OS overhead; tune UsableMemoryLimit in contentrouter.cfg</td>
        </tr>
        <tr>
          <td>Local MSDP Disk I/O</td>
          <td>Upload/download cache disk I/O becoming a bottleneck</td>
          <td><span class="sev sev-med">Medium</span></td>
          <td>Default 1 TB download cache + 12 GB upload cache on the same disk pool as the dedup DB; spindle-based storage creates IOPS contention</td>
          <td>Use NVMe/SSD for local MSDP pool; separate metadata DB path from storage path; tune DownloadDataCacheGB and DownloadMetaCacheGB per LSU</td>
        </tr>
        <tr>
          <td>Restore — Full Container Fetch</td>
          <td>Over-fetching from S3 on restore</td>
          <td><span class="sev sev-high">High</span></td>
          <td>Restore always downloads full 64 MB container even for 1 KB segment; multiplied by many concurrent restores = massive S3 egress cost + latency</td>
          <td>Size download cache adequately (≥ max_concurrent_restores × 64 MB per stream); use P-cache/S-cache (NBU 10.1+) to minimize redundant GETs; keep restore media server close to S3 region</td>
        </tr>
        <tr>
          <td>S3 API Rate Limits</td>
          <td>S3 throttling (HTTP 503 / SlowDown)</td>
          <td><span class="sev sev-med">Medium</span></td>
          <td>Burst of concurrent PUT/GET requests from multiple media servers hitting same S3 prefix</td>
          <td>Use unique lsuCloudBucketSubName per media server to distribute across S3 prefixes; enable S3 request retry/backoff in cloud.json</td>
        </tr>
        <tr>
          <td>No Cross-Server Dedup</td>
          <td>Deduplication inefficiency across N media servers</td>
          <td><span class="sev sev-med">Medium</span></td>
          <td>Each MSDP storage server has its own isolated fingerprint DB; same data backed up by two different media servers is stored twice in separate S3 buckets</td>
          <td>Use client-direct affinity in NBU policies (always send same client to same media server); or adopt MSDP Scaleout for shared namespace</td>
        </tr>
        <tr>
          <td>NBU Master</td>
          <td>Catalog/EMM database becoming a scheduling bottleneck</td>
          <td><span class="sev sev-low">Low</span></td>
          <td>With N media servers and high job concurrency, master's EMM and image catalog can queue jobs</td>
          <td>Size master per Veritas guidelines (RAM, CPU, fast catalog DB disk); limit concurrent jobs per policy; stagger backup windows</td>
        </tr>
        <tr>
          <td>Cloud LSU cache sizing</td>
          <td>~1 TB local MSDP space reserved per cloud LSU eating pool space</td>
          <td><span class="sev sev-med">Medium</span></td>
          <td>Default reservation leaves little usable space in smaller MSDP pools when multiple LSUs are configured</td>
          <td>From NBU 10.2+: explicitly configure cache size at LSU creation via web UI (CloudUploadCacheSize, CloudDataCacheSize, CloudMetaCacheSize in contentrouter.cfg)</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="info-box" style="margin-top:1rem;">
    <strong>2-hop summary:</strong> The two-hop architecture (Source→MediaServer→S3 for backup; S3→MediaServer→Client for restore) means the media server is always the <em>bottleneck chokepoint</em> — its RAM, local disk IOPS, NIC bandwidth, and WAN uplink to S3 all independently constrain throughput. Scaling out to N media servers scales backup throughput linearly, but only if client-to-media-server affinity prevents dedup efficiency loss.
  </div>
</div>

<script>
  function show(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.classList.add('active');
  }
</script>
</body>
</html>